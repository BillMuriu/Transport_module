(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[516],{957:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>D});var s=a(5155),r=a(2115),n=a(4605),i=a(3096),d=a(9145),o=a(3464),l=a(3574);let c=e=>(0,d.q)({queryKey:["studentsByRoute",e],enabled:!!e,queryFn:async t=>{let{pageParam:a=1}=t;return(await o.A.get("".concat(l.J,"/students/"),{params:{station__route:e,page:a,page_size:10}})).data},getNextPageParam:e=>{if(e.next){let t=new URL(e.next).searchParams.get("page");return t?parseInt(t,10):void 0}}});var u=a(6671),g=a(5041);let x=()=>(0,g.n)({mutationFn:async e=>(await o.A.post("".concat(l.J,"/trip-messages/send/"),e,{headers:{"Content-Type":"application/json"}})).data,onSuccess:e=>{console.log("Trip message sent successfully:",e)},onError:e=>{console.error("Trip message failed to send:",e)}});var h=a(6672),m=a(6981),p=a(5196),f=a(9433);function b(e){let{className:t,...a}=e;return(0,s.jsx)(m.bL,{"data-slot":"checkbox",className:(0,f.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,s.jsx)(m.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,s.jsx)(p.A,{className:"size-3.5"})})})}var v=a(1154);let j=e=>{let{student:t,index:a,onCheck:r,sending:n,sent:i}=e;return(0,s.jsxs)(h.P.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*a,duration:.3},className:"p-3 border rounded-md flex items-center space-x-3",children:[i?(0,s.jsx)("span",{className:"text-green-600 text-sm font-medium",children:"Sent ✅"}):n?(0,s.jsx)(v.A,{className:"h-4 w-4 animate-spin text-muted-foreground"}):(0,s.jsx)(b,{checked:!1,onCheckedChange:e=>r(e,t)}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:[t.first_name," ",t.last_name," – ",t.class_name]})]})},w=()=>{let{ref:e,inView:t}=(0,i.Wx)(),{data:a,fetchNextPage:d,hasNextPage:o,isFetchingNextPage:l}=c("3d2da454-05bb-42bb-b96f-5c3e4d2b1cd8"),{handleCheck:g,sending:h,sent:m,setStudentsNotSent:p}=function(){let e=(0,n.t)(e=>e.ongoingTrip),{mutate:t}=x(),[a,s]=(0,r.useState)({}),[i,d]=(0,r.useState)({}),[o,l]=(0,r.useState)([]);return{handleCheck:(a,r)=>{a&&!i[r.id]&&(null==e?void 0:e.id)&&(s(e=>({...e,[r.id]:!0})),t({student_id:r.id,trip_id:e.id},{onSuccess:()=>{d(e=>({...e,[r.id]:!0})),l(e=>e.filter(e=>e!==r.id)),u.o.success("Message for ".concat(r.first_name," sent successfully."))},onError:()=>{u.o.error("Failed to send message for ".concat(r.first_name,"."))},onSettled:()=>{s(e=>({...e,[r.id]:!1}))}}))},sending:a,sent:i,studentsNotSent:o,setStudentsNotSent:l}}();return((0,r.useEffect)(()=>{(null==a?void 0:a.pages)&&p(a.pages.flatMap(e=>e.results).filter(e=>!m[e.id]).map(e=>e.id))},[a,m]),(0,r.useEffect)(()=>{t&&o&&d()},[t,o]),a)?(0,s.jsxs)("ul",{className:"space-y-3",children:[a.pages.map(e=>e.results.map((e,t)=>(0,s.jsx)(j,{student:e,index:t,onCheck:g,sending:h[e.id],sent:m[e.id]},e.id))),(0,s.jsx)("div",{ref:e,className:"h-8"}),l&&(0,s.jsx)("p",{className:"text-center",children:"Loading more..."})]}):(0,s.jsx)("div",{children:"Loading..."})};var y=a(1978);let N=()=>(0,s.jsx)(y.$,{onClick:()=>console.log("Ending the trip..."),className:"w-full",children:"End Trip"});var k=a(5623),C=a(547);function _(e){let{...t}=e;return(0,s.jsx)(C.bL,{"data-slot":"popover",...t})}function T(e){let{...t}=e;return(0,s.jsx)(C.l9,{"data-slot":"popover-trigger",...t})}function z(e){let{className:t,align:a="center",sideOffset:r=4,...n}=e;return(0,s.jsx)(C.ZL,{children:(0,s.jsx)(C.UC,{"data-slot":"popover-content",align:a,sideOffset:r,className:(0,f.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...n})})}var E=a(7649);function S(e){let{...t}=e;return(0,s.jsx)(E.bL,{"data-slot":"alert-dialog",...t})}function L(e){let{...t}=e;return(0,s.jsx)(E.l9,{"data-slot":"alert-dialog-trigger",...t})}function P(e){let{...t}=e;return(0,s.jsx)(E.ZL,{"data-slot":"alert-dialog-portal",...t})}function A(e){let{className:t,...a}=e;return(0,s.jsx)(E.hJ,{"data-slot":"alert-dialog-overlay",className:(0,f.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function O(e){let{className:t,...a}=e;return(0,s.jsxs)(P,{children:[(0,s.jsx)(A,{}),(0,s.jsx)(E.UC,{"data-slot":"alert-dialog-content",className:(0,f.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function $(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,f.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function F(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,f.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function J(e){let{className:t,...a}=e;return(0,s.jsx)(E.hE,{"data-slot":"alert-dialog-title",className:(0,f.cn)("text-lg font-semibold",t),...a})}function Z(e){let{className:t,...a}=e;return(0,s.jsx)(E.VY,{"data-slot":"alert-dialog-description",className:(0,f.cn)("text-muted-foreground text-sm",t),...a})}function q(e){let{className:t,...a}=e;return(0,s.jsx)(E.rc,{className:(0,f.cn)((0,y.r)(),t),...a})}function R(e){let{className:t,...a}=e;return(0,s.jsx)(E.ZD,{className:(0,f.cn)((0,y.r)({variant:"outline"}),t),...a})}let U=()=>(0,s.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,s.jsxs)(_,{children:[(0,s.jsx)(T,{className:"w-12 h-12 bg-foreground/80 text-white rounded-full flex items-center justify-center shadow-md border border-white/10 hover:bg-black/70 transition-colors",children:(0,s.jsx)(k.A,{className:"w-5 h-5"})}),(0,s.jsxs)(z,{className:"w-64 p-4 mr-4 mt-10 bg-foreground shadow-lg rounded-lg flex flex-col gap-2",children:[(0,s.jsxs)(S,{children:[(0,s.jsx)(L,{asChild:!0,children:(0,s.jsx)(y.$,{className:"w-full",children:"Cancel Trip"})}),(0,s.jsxs)(O,{children:[(0,s.jsxs)($,{children:[(0,s.jsx)(J,{children:"Cancel this trip?"}),(0,s.jsx)(Z,{children:"Cancelling now will discard all current trip data. This action cannot be undone."})]}),(0,s.jsxs)(F,{children:[(0,s.jsx)(R,{children:"Close"}),(0,s.jsx)(q,{className:"bg-destructive text-white hover:bg-destructive/90",children:"Confirm Cancel"})]})]})]}),(0,s.jsxs)(S,{children:[(0,s.jsx)(L,{asChild:!0,children:(0,s.jsx)(y.$,{variant:"ghost",className:"w-full bg-background text-foreground border border-border",children:"End Trip"})}),(0,s.jsxs)(O,{children:[(0,s.jsxs)($,{children:[(0,s.jsx)(J,{children:"Are you sure you want to end the trip?"}),(0,s.jsxs)(Z,{className:"space-y-2",children:[(0,s.jsx)("p",{children:"You’re about to end the trip."}),(0,s.jsxs)("p",{children:["Parents of the ",(0,s.jsx)("span",{className:"font-semibold",children:"10"})," ","students who boarded will be notified that their children have arrived safely."]}),(0,s.jsxs)("p",{children:["Parents of the ",(0,s.jsx)("span",{className:"font-semibold",children:"20"})," ","students who did not board will be informed that their children did not take the trip."]})]})]}),(0,s.jsxs)(F,{children:[(0,s.jsx)(R,{children:"Cancel"}),(0,s.jsx)(q,{className:"bg-primary text-white hover:bg-primary/90",children:"Confirm End Trip"})]})]})]})]})]})}),D=()=>{let e=(0,n.t)(e=>e.ongoingTrip);return(0,s.jsxs)("div",{className:"max-w-md mx-auto p-6",children:[(null==e?void 0:e.id)&&(0,s.jsxs)("h3",{className:"text-base font-medium text-muted-foreground mb-4 text-center",children:["Ongoing Trip ID: ",e.id]}),(0,s.jsx)("h2",{className:"text-xl font-semibold mb-6 text-center",children:"Students on Route"}),(0,s.jsx)(w,{}),(null==e?void 0:e.id)&&(0,s.jsx)(N,{}),(0,s.jsx)(U,{})]})}},1978:(e,t,a)=>{"use strict";a.d(t,{$:()=>o,r:()=>d});var s=a(5155);a(2115);var r=a(9708),n=a(2085),i=a(9433);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:a,size:n,asChild:o=!1,...l}=e,c=o?r.Slot:"button";return(0,s.jsx)(c,{"data-slot":"button",className:(0,i.cn)(d({variant:a,size:n,className:t})),...l})}},3574:(e,t,a)=>{"use strict";a.d(t,{J:()=>s});let s="http://206.189.199.238:8000"},4054:(e,t,a)=>{Promise.resolve().then(a.bind(a,957))},4605:(e,t,a)=>{"use strict";a.d(t,{t:()=>n});var s=a(5453),r=a(6786);let n=(0,s.v)((0,r.Zr)(e=>({ongoingTrip:null,setOngoingTrip:t=>e({ongoingTrip:t}),clearOngoingTrip:()=>e({ongoingTrip:null})}),{name:"ongoing-trip-storage",partialize:e=>({ongoingTrip:e.ongoingTrip})}))},9433:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var s=a(2596),r=a(9688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[947,832,89,128,57,452,645,441,684,358],()=>t(4054)),_N_E=e.O()}]);